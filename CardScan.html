<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo Tra Cứu Thẻ An Toàn Điện</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background-color: #f0f2f5; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .container { max-width: 450px; width: 100%; background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        h2 { color: #1a73e8; text-align: center; margin-bottom: 10px; }
        
        /* Khu vực quét */
        #reader { width: 100%; border-radius: 15px; overflow: hidden; background: #000; margin-bottom: 15px; }
        .controls { display: flex; gap: 10px; margin-bottom: 20px; }
        
        /* Nút bấm */
        button { flex: 1; padding: 12px; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; transition: 0.3s; font-size: 15px; }
        .btn-scan { background-color: #1a73e8; color: white; }
        .btn-stop { background-color: #ea4335; color: white; display: none; }
        .btn-lookup { background-color: #34a853; color: white; width: 100%; margin-top: 10px; }
        
        input { width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 16px; box-sizing: border-box; outline: none; }
        input:focus { border-color: #1a73e8; }

        /* Card kết quả */
        #result-card { display: none; margin-top: 20px; padding: 20px; border-radius: 15px; background: #f8f9fa; border: 1px solid #e0e0e0; }
        .status-badge { display: inline-block; padding: 5px 12px; border-radius: 20px; background: #ceead6; color: #0d652d; font-size: 13px; font-weight: bold; margin-bottom: 10px; }
        .info-item { margin-bottom: 12px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        .label { font-size: 12px; color: #70757a; text-transform: uppercase; }
        .value { font-size: 17px; color: #202124; font-weight: 500; }
    </style>
</head>
<body>

<div class="container">
    <h2>Hệ Thống An Toàn</h2>
    <p style="text-align: center; font-size: 14px; color: #5f6368;">Quét mã QR trên CCCD để kiểm tra thẻ an toàn điện</p>

    <div id="reader"></div>

    <div class="controls">
        <button id="start-btn" class="btn-scan" onclick="startScanning()">Bắt đầu Quét QR</button>
        <button id="stop-btn" class="btn-stop" onclick="stopScanning()">Dừng Quét</button>
    </div>

    <div class="input-group">
        <input type="text" id="cccd-input" placeholder="Nhập số CCCD thủ công">
        <button class="btn-lookup" onclick="simulateLookup()">Tra cứu</button>
    </div>

    <div id="result-card">
        <div class="status-badge">✓ ĐÃ CẤP THẺ ĐIỆN TỬ</div>
        
        <div class="info-item">
            <div class="label">Họ và tên</div>
            <div id="res-name" class="value">-</div>
        </div>

        <div class="info-item">
            <div class="label">Số định danh (CCCD)</div>
            <div id="res-cccd" class="value">-</div>
        </div>

        <div class="info-item">
            <div class="label">Bậc an toàn điện</div>
            <div class="value" style="color: #1a73e8;">Bậc 3 / 5</div>
        </div>

        <div class="info-item">
            <div class="label">Ngày hết hạn</div>
            <div class="value">20/12/2026</div>
        </div>
    </div>
</div>

<script>
    const html5QrCode = new Html5Qrcode("reader");
    const startBtn = document.getElementById('start-btn');
    const stopBtn = document.getElementById('stop-btn');

    function startScanning() {
        startBtn.style.display = 'none';
        stopBtn.style.display = 'inline-block';
        document.getElementById('result-card').style.display = 'none';

        const config = { fps: 10, qrbox: { width: 250, height: 250 } };

        // Ưu tiên camera sau (facingMode: environment)
        html5QrCode.start({ facingMode: "environment" }, config, (decodedText) => {
            // Xử lý chuỗi dữ liệu CCCD của Bộ Công An
            const parts = decodedText.split('|');
            const cccdNumber = parts[0];
            const fullName = parts[2] || "Nhân viên Demo";

            showResult(cccdNumber, fullName);
            stopScanning(); // Dừng camera sau khi quét thành công
        }).catch(err => {
            alert("Lỗi camera: " + err);
            stopScanning();
        });
    }

    function stopScanning() {
        html5QrCode.stop().then(() => {
            startBtn.style.display = 'inline-block';
            stopBtn.style.display = 'none';
        }).catch(err => console.log(err));
    }

    function showResult(cccd, name) {
        document.getElementById('cccd-input').value = cccd;
        document.getElementById('res-cccd').innerText = cccd;
        document.getElementById('res-name').innerText = name;
        document.getElementById('result-card').style.display = 'block';
    }

    function simulateLookup() {
        const val = document.getElementById('cccd-input').value;
        if (val.length < 9) {
            alert("Vui lòng nhập số CCCD");
            return;
        }
        showResult(val, "Dữ liệu mẫu từ hệ thống");
    }
</script>

</body>
</html>
