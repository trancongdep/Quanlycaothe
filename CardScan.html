const validProvinceCodes = [
    "001", "002", "004", "006", "008", "010", "011", "012", "014", "015", "017", "019", "020", "022", "024", "025", "026", "027", "030", "031", "033", "034", "035", "036", "037", "038", "040", "042", "044", "045", "046", "048", "049", "051", "052", "054", "056", "058", "060", "062", "064", "066", "067", "068", "070", "072", "074", "075", "077", "079", "080", "082", "083", "084", "086", "087", "089", "091", "092", "093", "094", "095", "096"
];

function validateCCCD(cccd) {
    // 1. Kiểm tra độ dài và ký tự số
    if (!/^\d{12}$/.test(cccd)) {
        return { valid: false, msg: "CCCD phải bao gồm đúng 12 chữ số." };
    }

    // 2. Kiểm tra mã tỉnh (3 số đầu)
    const province = cccd.substring(0, 3);
    if (!validProvinceCodes.includes(province)) {
        return { valid: false, msg: "Mã tỉnh (3 số đầu) không hợp lệ." };
    }

    // 3. Kiểm tra mã giới tính (số thứ 4)
    const genderCode = parseInt(cccd.charAt(3));
    if (genderCode > 9) { // Thực tế chỉ từ 0-9 nhưng regex đã check rồi
        return { valid: false, msg: "Mã giới tính không hợp lệ." };
    }

    // Nếu vượt qua tất cả
    return { valid: true, msg: "Hợp lệ" };
}

// Cách áp dụng vào hàm tra cứu hiện tại của bạn:
function checkSafetyCard() {
    const input = document.getElementById('cccd-input').value;
    const check = validateCCCD(input);

    if (!check.valid) {
        alert(check.msg);
        return;
    }
    
    // ... Tiếp tục logic tra cứu mockData hoặc Firebase như cũ ...
}

