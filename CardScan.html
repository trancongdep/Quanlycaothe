<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OCR CCCD - H·ªá Th·ªëng An To√†n ƒêi·ªán</title>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f0f2f5; display: flex; justify-content: center; padding: 20px; }
        .card { max-width: 500px; width: 100%; background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        h2 { color: #1a73e8; text-align: center; margin-bottom: 5px; }
        .subtitle { text-align: center; font-size: 14px; color: #666; margin-bottom: 20px; }
        
        .upload-area { border: 2px dashed #1a73e8; padding: 30px; border-radius: 15px; text-align: center; cursor: pointer; transition: 0.3s; position: relative; }
        .upload-area:hover { background: #f1f7ff; }
        #preview { width: 100%; border-radius: 10px; margin-top: 15px; display: none; }
        
        .loading { display: none; margin: 20px 0; text-align: center; color: #1a73e8; font-weight: bold; }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #1a73e8; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 10px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .result-box { display: none; background: #f8f9fa; padding: 15px; border-radius: 12px; border: 1px solid #ddd; margin-top: 20px; }
        .field { margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        .label { font-size: 11px; color: #888; text-transform: uppercase; }
        .value { font-size: 16px; color: #333; font-weight: 600; }
        
        #file-input { display: none; }
        .btn-main { width: 100%; padding: 15px; background: #1a73e8; color: white; border: none; border-radius: 10px; font-weight: bold; margin-top: 15px; cursor: pointer; }
    </style>
</head>
<body>

<div class="card">
    <h2>Tr√≠ch Xu·∫•t Th√¥ng Tin CCCD</h2>
    <p class="subtitle">Ch·ª•p ·∫£nh m·∫∑t tr∆∞·ªõc CCCD r√µ n√©t ƒë·ªÉ demo</p>

    <div class="upload-area" onclick="document.getElementById('file-input').click()">
        <p id="upload-text">üì∏ Nh·∫•n ƒë·ªÉ ch·ª•p ·∫£nh ho·∫∑c ch·ªçn ·∫£nh th·∫ª</p>
        <input type="file" id="file-input" accept="image/*" capture="environment">
        <img id="preview" src="">
    </div>

    <div id="loading-status" class="loading">
        <div class="spinner"></div>
        <p>ƒêang ph√¢n t√≠ch d·ªØ li·ªáu h√¨nh ·∫£nh... <span id="progress">0%</span></p>
    </div>

    <div id="result-box" class="result-box">
        <div class="field">
            <div class="label">S·ªë CCCD / ID No.</div>
            <div id="res-id" class="value">ƒêang ƒë·ªçc...</div>
        </div>
        <div class="field">
            <div class="label">H·ªç v√† t√™n / Full Name</div>
            <div id="res-name" class="value">ƒêang ƒë·ªçc...</div>
        </div>
        <div class="field">
            <div class="label">Ng√†y sinh / Date of Birth</div>
            <div id="res-dob" class="value">ƒêang ƒë·ªçc...</div>
        </div>
        <div class="field">
            <div class="label">Gi·ªõi t√≠nh / Sex</div>
            <div id="res-sex" class="value">ƒêang ƒë·ªçc...</div>
        </div>
        <button class="btn-main" onclick="location.reload()">Qu√©t th·∫ª kh√°c</button>
    </div>
</div>

<script>
    const fileInput = document.getElementById('file-input');
    const preview = document.getElementById('preview');
    const loadingStatus = document.getElementById('loading-status');
    const resultBox = document.getElementById('result-box');
    const progressText = document.getElementById('progress');

    fileInput.addEventListener('change', async (e) => {
        const file = e.target.files[0];
        if (!file) return;

        // 1. Hi·ªÉn th·ªã ·∫£nh xem tr∆∞·ªõc
        const reader = new FileReader();
        reader.onload = (f) => {
            preview.src = f.target.result;
            preview.style.display = 'block';
            document.getElementById('upload-text').style.display = 'none';
        };
        reader.readAsDataURL(file);

        // 2. Ti·∫øn h√†nh OCR
        loadingStatus.style.display = 'block';
        resultBox.style.display = 'none';

        try {
            const worker = await Tesseract.createWorker('vie', 1, {
                logger: m => {
                    if (m.status === 'recognizing text') {
                        progressText.innerText = Math.round(m.progress * 100) + '%';
                    }
                }
            });

            const { data: { text } } = await worker.recognize(file);
            console.log("To√†n b·ªô vƒÉn b·∫£n ƒë·ªçc ƒë∆∞·ª£c:", text);

            // 3. X·ª≠ l√Ω t√°ch chu·ªói d·ª±a tr√™n c·∫•u tr√∫c CCCD Vi·ªát Nam
            // (S·ª≠ d·ª•ng Regex ƒë∆°n gi·∫£n ƒë·ªÉ demo)
            const idMatch = text.match(/\d{12}/); // T√¨m d√£y 12 s·ªë li√™n ti·∫øp
            const lines = text.split('\n');
            
            document.getElementById('res-id').innerText = idMatch ? idMatch[0] : "Kh√¥ng t√¨m th·∫•y s·ªë";
            document.getElementById('res-name').innerText = extractName(text);
            document.getElementById('res-dob').innerText = extractDOB(text);
            document.getElementById('res-sex').innerText = text.includes('N·ªØ') ? 'N·ªØ' : 'Nam';

            await worker.terminate();
            
            loadingStatus.style.display = 'none';
            resultBox.style.display = 'block';
        } catch (error) {
            alert("L·ªói khi x·ª≠ l√Ω ·∫£nh: " + error);
            loadingStatus.style.display = 'none';
        }
    });

    // H√†m b·ªï tr·ª£ tr√≠ch xu·∫•t t√™n (demo ƒë∆°n gi·∫£n)
    function extractName(text) {
        // Th√¥ng th∆∞·ªùng t√™n n·∫±m sau ch·ªØ "H·ªç v√† t√™n" ho·∫∑c "Full name"
        const lines = text.split('\n');
        for (let i = 0; i < lines.length; i++) {
            if (lines[i].toUpperCase().includes('H·ªå V√Ä T√äN') || lines[i].toUpperCase().includes('FULL NAME')) {
                return lines[i+1] || "Kh√¥ng x√°c ƒë·ªãnh";
            }
        }
        return "Vui l√≤ng ch·ª•p r√µ m·∫∑t tr∆∞·ªõc";
    }

    // H√†m b·ªï tr·ª£ tr√≠ch xu·∫•t ng√†y sinh
    function extractDOB(text) {
        const dobMatch = text.match(/\d{2}\/\d{2}\/\d{4}/);
        return dobMatch ? dobMatch[0] : "Kh√¥ng x√°c ƒë·ªãnh";
    }
</script>

</body>
</html>
