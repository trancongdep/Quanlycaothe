<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo Tra Cứu Thẻ An Toàn Điện</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f7f6; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .container { max-width: 500px; width: 100%; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { color: #2c3e50; text-align: center; margin-bottom: 20px; }
        #reader { width: 100%; border-radius: 10px; overflow: hidden; border: 2px dashed #3498db; }
        .input-group { margin-top: 20px; display: flex; flex-direction: column; }
        input { padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; margin-bottom: 10px; }
        button { padding: 12px; background-color: #3498db; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; transition: 0.3s; }
        button:hover { background-color: #2980b9; }
        
        /* Hiển thị kết quả giả lập (Demo) */
        #result-card { display: none; margin-top: 20px; padding: 15px; border-radius: 10px; border-left: 5px solid #2ecc71; background: #e8f8f5; }
        .info-label { font-weight: bold; color: #7f8c8d; font-size: 14px; }
        .info-value { font-size: 18px; color: #2c3e50; margin-bottom: 10px; }
        .status-active { color: #27ae60; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h2>Hệ Thống An Toàn Điện</h2>
    <p style="text-align: center; color: #666;">Quét mã QR trên thẻ CCCD để tra cứu</p>

    <div id="reader"></div>

    <div class="input-group">
        <input type="text" id="cccd-input" placeholder="Hoặc nhập thủ công số CCCD">
        <button onclick="simulateLookup()">Tra cứu thủ công</button>
    </div>

    <div id="result-card">
        <h3 style="margin-top: 0; color: #27ae60;">✓ Thông tin hợp lệ</h3>
        <div class="info-label">Số CCCD:</div>
        <div id="res-cccd" class="info-value">-</div>
        
        <div class="info-label">Họ tên nhân viên:</div>
        <div id="res-name" class="info-value">-</div>

        <div class="info-label">Bậc an toàn điện:</div>
        <div id="res-level" class="info-value">Bậc 3/5</div>

        <div class="info-label">Trạng thái:</div>
        <div class="status-active">ĐANG CÒN HIỆU LỰC</div>
    </div>
</div>

<script>
    // 1. Cấu hình máy quét mã QR
    const html5QrCode = new Html5Qrcode("reader");
    const config = { fps: 10, qrbox: { width: 250, height: 250 } };

    // Bắt đầu quét
    html5QrCode.start({ facingMode: "environment" }, config, (decodedText) => {
        // Xử lý dữ liệu sau khi quét thành công
        // Dữ liệu QR CCCD thường là: 03809xxxxxxx|Số cũ|Họ tên|Ngày sinh|...
        const parts = decodedText.split('|');
        const cccdNumber = parts[0];
        const fullName = parts[2] || "Nguyễn Văn A (Demo)";

        // Hiển thị lên giao diện
        showResult(cccdNumber, fullName);
        
        // (Tùy chọn) Dừng camera sau khi quét xong để tiết kiệm pin
        // html5QrCode.stop();
    });

    // 2. Hàm hiển thị kết quả giả lập
    function showResult(cccd, name) {
        document.getElementById('cccd-input').value = cccd;
        document.getElementById('res-cccd').innerText = cccd;
        document.getElementById('res-name').innerText = name;
        document.getElementById('result-card').style.display = 'block';
        
        // Hiệu ứng cuộn xuống kết quả
        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    }

    // 3. Hàm tra cứu thủ công (Giả lập)
    function simulateLookup() {
        const val = document.getElementById('cccd-input').value;
        if (val.length < 9) {
            alert("Vui lòng nhập số CCCD hợp lệ");
            return;
        }
        showResult(val, "Nhân viên Demo (Dữ liệu mẫu)");
    }
</script>

</body>
</html>
